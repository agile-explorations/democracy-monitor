/**
 * Intent assessment fixtures per scenario.
 */

import type {
  IntentAssessment,
  IntentStatement,
  PolicyArea,
  IntentScore,
  GovernanceCategory,
} from '@/lib/types';
import { POLICY_AREAS } from '@/lib/types';
import { toDateString } from '@/lib/utils/date-utils';
import type { ScenarioName } from '../scenarios';
import { DEMO_SCENARIOS } from '../scenarios';

function daysAgo(n: number): string {
  return toDateString(new Date(Date.now() - n * 86400000));
}

function makePolicyScores(rhetoric: number, action: number): Record<PolicyArea, IntentScore> {
  const result: Record<string, IntentScore> = {};
  const jitter = [0, 0.1, -0.1, 0.15, -0.05];
  for (let i = 0; i < POLICY_AREAS.length; i++) {
    const r = Math.max(-2, Math.min(2, rhetoric + jitter[i]));
    const a = Math.max(-2, Math.min(2, action + jitter[(i + 2) % 5]));
    result[POLICY_AREAS[i]] = {
      rhetoric: +r.toFixed(2),
      action: +a.toFixed(2),
      gap: +Math.abs(r - a).toFixed(2),
    };
  }
  return result as Record<PolicyArea, IntentScore>;
}

const STATEMENTS: Record<ScenarioName, IntentStatement[]> = {
  mixed: [
    {
      text: 'We will restore accountability to the federal bureaucracy.',
      source: 'White House Press Briefing',
      sourceTier: 1,
      type: 'rhetoric',
      policyArea: 'institutional_independence',
      score: 0.8,
      date: daysAgo(1),
    },
    {
      text: 'Executive Order signed reclassifying 50,000 federal positions.',
      source: 'Federal Register',
      sourceTier: 1,
      type: 'action',
      policyArea: 'institutional_independence',
      score: 1.5,
      date: daysAgo(2),
    },
    {
      text: 'The courts have overstepped their constitutional authority.',
      source: 'Presidential Address',
      sourceTier: 1,
      type: 'rhetoric',
      policyArea: 'rule_of_law',
      score: 1.2,
      date: daysAgo(3),
    },
    {
      text: 'DOJ files brief arguing for expanded executive privilege in pending cases.',
      source: 'DOJ Press Release',
      sourceTier: 1,
      type: 'action',
      policyArea: 'rule_of_law',
      score: 1.0,
      date: daysAgo(4),
    },
    {
      text: 'We believe in a free press, even when they get it wrong.',
      source: 'Presidential Interview',
      sourceTier: 1,
      type: 'rhetoric',
      policyArea: 'media_freedom',
      score: 0.3,
      date: daysAgo(5),
    },
    {
      text: 'FCC opens review of broadcast license renewal standards.',
      source: 'Federal Register',
      sourceTier: 1,
      type: 'action',
      policyArea: 'media_freedom',
      score: 0.8,
      date: daysAgo(6),
    },
    {
      text: 'We need election integrity measures to protect every vote.',
      source: 'White House Statement',
      sourceTier: 1,
      type: 'rhetoric',
      policyArea: 'elections',
      score: 0.5,
      date: daysAgo(7),
    },
    {
      text: 'DOJ initiates investigation into voter registration practices in 6 states.',
      source: 'DOJ Announcement',
      sourceTier: 1,
      type: 'action',
      policyArea: 'elections',
      score: 0.9,
      date: daysAgo(8),
    },
    {
      text: 'Civil liberties will always be protected under this administration.',
      source: 'Presidential Speech',
      sourceTier: 1,
      type: 'rhetoric',
      policyArea: 'civil_liberties',
      score: -0.2,
      date: daysAgo(10),
    },
    {
      text: 'DHS expands surveillance program at transportation hubs.',
      source: 'DHS Directive',
      sourceTier: 1,
      type: 'action',
      policyArea: 'civil_liberties',
      score: 1.0,
      date: daysAgo(11),
    },
  ],
  stable: [
    {
      text: 'We are committed to strengthening democratic institutions.',
      source: 'State of the Union Address',
      sourceTier: 1,
      type: 'rhetoric',
      policyArea: 'institutional_independence',
      score: -1.0,
      date: daysAgo(1),
    },
    {
      text: 'Executive Order restoring civil service protections for career employees.',
      source: 'Federal Register',
      sourceTier: 1,
      type: 'action',
      policyArea: 'institutional_independence',
      score: -1.2,
      date: daysAgo(2),
    },
    {
      text: 'The independence of the judiciary is fundamental to our democracy.',
      source: 'Presidential Remarks',
      sourceTier: 1,
      type: 'rhetoric',
      policyArea: 'rule_of_law',
      score: -0.8,
      date: daysAgo(3),
    },
    {
      text: 'DOJ reaffirms commitment to comply with all court orders.',
      source: 'DOJ Press Release',
      sourceTier: 1,
      type: 'action',
      policyArea: 'rule_of_law',
      score: -0.7,
      date: daysAgo(5),
    },
    {
      text: 'A free and vibrant press is essential for democracy.',
      source: 'Presidential Proclamation',
      sourceTier: 1,
      type: 'rhetoric',
      policyArea: 'media_freedom',
      score: -0.9,
      date: daysAgo(7),
    },
    {
      text: 'OMB releases full budget execution data ahead of schedule.',
      source: 'OMB Report',
      sourceTier: 1,
      type: 'action',
      policyArea: 'civil_liberties',
      score: -0.5,
      date: daysAgo(9),
    },
    {
      text: 'We must ensure every eligible voter can participate in elections.',
      source: 'White House Statement',
      sourceTier: 1,
      type: 'rhetoric',
      policyArea: 'elections',
      score: -0.6,
      date: daysAgo(10),
    },
    {
      text: 'EAC expands voter registration assistance programs.',
      source: 'Federal Register',
      sourceTier: 1,
      type: 'action',
      policyArea: 'elections',
      score: -0.4,
      date: daysAgo(12),
    },
  ],
  crisis: [
    {
      text: 'The existing bureaucracy is the enemy of the people.',
      source: 'Presidential Rally',
      sourceTier: 1,
      type: 'rhetoric',
      policyArea: 'institutional_independence',
      score: 2.0,
      date: daysAgo(1),
    },
    {
      text: '12 Inspectors General fired in single Friday night action.',
      source: 'White House Press Release',
      sourceTier: 1,
      type: 'action',
      policyArea: 'institutional_independence',
      score: 2.0,
      date: daysAgo(1),
    },
    {
      text: 'Judges who block our agenda are threats to national security.',
      source: 'Presidential Address',
      sourceTier: 1,
      type: 'rhetoric',
      policyArea: 'rule_of_law',
      score: 2.0,
      date: daysAgo(2),
    },
    {
      text: 'Executive branch refuses to comply with 3 federal court injunctions.',
      source: 'DOJ Filing',
      sourceTier: 1,
      type: 'action',
      policyArea: 'rule_of_law',
      score: 2.0,
      date: daysAgo(2),
    },
    {
      text: 'Hostile media outlets will face consequences for their lies.',
      source: 'Presidential Statement',
      sourceTier: 1,
      type: 'rhetoric',
      policyArea: 'media_freedom',
      score: 1.8,
      date: daysAgo(3),
    },
    {
      text: 'FCC revokes broadcast licenses of two major networks.',
      source: 'FCC Order',
      sourceTier: 1,
      type: 'action',
      policyArea: 'media_freedom',
      score: 2.0,
      date: daysAgo(3),
    },
    {
      text: 'Only our supporters are the true voice of the people.',
      source: 'Presidential Rally',
      sourceTier: 1,
      type: 'rhetoric',
      policyArea: 'elections',
      score: 1.9,
      date: daysAgo(4),
    },
    {
      text: 'DOJ deploys federal agents to monitor voting in opposition strongholds.',
      source: 'DOJ Directive',
      sourceTier: 1,
      type: 'action',
      policyArea: 'elections',
      score: 1.8,
      date: daysAgo(5),
    },
    {
      text: 'National emergency requires temporary suspension of certain rights.',
      source: 'Presidential Proclamation',
      sourceTier: 1,
      type: 'rhetoric',
      policyArea: 'civil_liberties',
      score: 2.0,
      date: daysAgo(6),
    },
    {
      text: 'DHS authorized to conduct warrantless surveillance in border zones.',
      source: 'DHS Directive',
      sourceTier: 1,
      type: 'action',
      policyArea: 'civil_liberties',
      score: 1.9,
      date: daysAgo(6),
    },
    {
      text: 'Active duty military deployed to 5 major cities for law enforcement.',
      source: 'DOD Press Release',
      sourceTier: 1,
      type: 'action',
      policyArea: 'rule_of_law',
      score: 2.0,
      date: daysAgo(7),
    },
    {
      text: 'All agency communications must be pre-cleared by White House.',
      source: 'OMB Memorandum',
      sourceTier: 1,
      type: 'action',
      policyArea: 'institutional_independence',
      score: 1.8,
      date: daysAgo(8),
    },
  ],
  degrading: [
    {
      text: 'We need to reform government to serve the people, not the bureaucrats.',
      source: 'White House Press Briefing',
      sourceTier: 1,
      type: 'rhetoric',
      policyArea: 'institutional_independence',
      score: 0.8,
      date: daysAgo(1),
    },
    {
      text: 'OMB orders spending reviews for all discretionary programs.',
      source: 'OMB Memorandum',
      sourceTier: 1,
      type: 'action',
      policyArea: 'institutional_independence',
      score: 1.2,
      date: daysAgo(2),
    },
    {
      text: 'Some judges are making policy rather than interpreting law.',
      source: 'Presidential Remarks',
      sourceTier: 1,
      type: 'rhetoric',
      policyArea: 'rule_of_law',
      score: 0.6,
      date: daysAgo(4),
    },
    {
      text: 'DOJ seeks emergency stay on immigration ruling, citing executive authority.',
      source: 'Court Filing',
      sourceTier: 1,
      type: 'action',
      policyArea: 'rule_of_law',
      score: 1.0,
      date: daysAgo(5),
    },
    {
      text: 'The media needs to be more responsible in their reporting.',
      source: 'Presidential Interview',
      sourceTier: 1,
      type: 'rhetoric',
      policyArea: 'media_freedom',
      score: 0.5,
      date: daysAgo(6),
    },
    {
      text: 'White House restricts press pool access to selected outlets.',
      source: 'White House Correspondents',
      sourceTier: 2,
      type: 'action',
      policyArea: 'media_freedom',
      score: 1.1,
      date: daysAgo(7),
    },
    {
      text: 'Election security is our top priority.',
      source: 'White House Statement',
      sourceTier: 1,
      type: 'rhetoric',
      policyArea: 'elections',
      score: 0.3,
      date: daysAgo(8),
    },
    {
      text: 'DOJ requests voter roll data from 12 states.',
      source: 'DOJ Letter',
      sourceTier: 1,
      type: 'action',
      policyArea: 'elections',
      score: 0.9,
      date: daysAgo(9),
    },
    {
      text: 'Security measures at the border are necessary and temporary.',
      source: 'DHS Secretary Remarks',
      sourceTier: 1,
      type: 'rhetoric',
      policyArea: 'civil_liberties',
      score: 0.4,
      date: daysAgo(10),
    },
    {
      text: 'DHS extends emergency surveillance authority for an additional 6 months.',
      source: 'Federal Register',
      sourceTier: 1,
      type: 'action',
      policyArea: 'civil_liberties',
      score: 1.0,
      date: daysAgo(11),
    },
  ],
};

export function getDemoIntentAssessment(scenario: ScenarioName): IntentAssessment {
  const config = DEMO_SCENARIOS[scenario];
  const { rhetoricScore, actionScore, overall } = config.intent;

  return {
    overall,
    confidence: 0.75,
    rhetoricScore,
    actionScore,
    gap: +Math.abs(rhetoricScore - actionScore).toFixed(2),
    policyAreas: makePolicyScores(rhetoricScore, actionScore),
    recentStatements: STATEMENTS[scenario],
    assessedAt: new Date().toISOString(),
  };
}
